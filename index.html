<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>献立プロト v2</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <!-- 0. オンボーディング -->
    <div id="screen-onboarding" class="screen active">
      <div class="onboarding-container">
        <div class="onboarding-illustration">🍳</div>
        <h1 class="onboarding-title">何作ろう？</h1>
        <p class="onboarding-description">
          レシピをセットにして、<br>
          リストから選んで作る。<br>
          それだけ。
        </p>
        <div class="onboarding-steps">
          <div class="onboarding-step">
            <span class="step-icon">1</span>
            <span class="step-text">セットを選ぶ</span>
          </div>
          <div class="onboarding-step">
            <span class="step-icon">2</span>
            <span class="step-text">買い物する</span>
          </div>
          <div class="onboarding-step">
            <span class="step-icon">3</span>
            <span class="step-text">リストから選んで作る</span>
          </div>
        </div>
        <button class="btn-primary" onclick="App.startApp()">はじめる</button>
      </div>
    </div>

    <!-- 1. レシピSet選択（メイン画面） -->
    <div id="screen-main" class="screen">
      <header class="header header-main">
        <div class="header-logo">
          <span class="logo-icon">🍳</span>
          <span class="logo-text">kondate loop</span>
        </div>
        <div class="header-actions">
          <button class="header-action has-badge" onclick="App.showFridge()">
            <span class="material-icons-round">kitchen</span>
            <span class="action-badge" id="badge-fridge-main"></span>
          </button>
          <button class="header-action has-badge" onclick="App.showScreen('shopping')">
            <span class="material-icons-round">shopping_cart</span>
            <span class="action-badge" id="badge-shopping-main"></span>
          </button>
        </div>
      </header>

      <main class="main-content with-nav">
        <h2 class="screen-title">献立</h2>
        <!-- 現在のセットがない場合 -->
        <div id="empty-state" class="empty-state">
          <div class="empty-illustration">🃏</div>
          <p class="empty-text">献立がありません</p>
          <p class="empty-subtext">セットを選択してください</p>
          <button class="btn-primary" onclick="App.showScreen('set-select')">
            セットを選ぶ
          </button>
        </div>

        <!-- 現在のセットがある場合 -->
        <div id="current-pool" class="current-pool hidden">
          <div class="pool-header">
            <span class="pool-label" id="current-set-name">セット名</span>
            <button class="btn-text" onclick="App.clearCurrentSet()">リセット</button>
          </div>
          <div class="cards-container" id="pool-cards">
            <!-- カードがここに入る -->
          </div>
          <div class="pool-actions">
            <button class="btn-secondary" onclick="App.showScreen('set-select')">
              セットを変える
            </button>
          </div>
        </div>

        <!-- 冷蔵庫への導線 -->
        <div id="fridge-shortcut" class="fridge-shortcut hidden">
          <button class="btn-fridge" onclick="App.showFridge()">
            <span class="fridge-icon">🧊</span>
            <span>冷蔵庫を見る</span>
            <span class="fridge-badge" id="fridge-count"></span>
          </button>
        </div>

        <!-- 次の献立 -->
        <div id="next-set-section" class="next-set-section hidden">
          <div class="section-header">
            <span class="section-label">次の献立</span>
          </div>
          <div id="next-set-content">
            <!-- 次の献立の内容 -->
          </div>
        </div>

        <!-- 履歴 -->
        <div id="history-section" class="history-section hidden">
          <button class="history-toggle" onclick="App.toggleHistory()">
            <span class="material-icons-round" id="history-toggle-icon">expand_more</span>
            <span>過去の献立</span>
            <span class="history-count" id="history-count">0</span>
          </button>
          <div id="history-list" class="history-list hidden">
            <!-- 履歴がここに入る -->
          </div>
        </div>
      </main>

      <nav class="bottom-nav">
        <button class="nav-item active" onclick="App.showScreen('main')">
          <span class="material-icons-round">style</span>
          <span class="nav-label">献立</span>
        </button>
        <button class="nav-item" onclick="App.showScreen('recipes')">
          <span class="material-icons-round">menu_book</span>
          <span class="nav-label">わたしの</span>
        </button>
        <button class="nav-item" onclick="App.showScreen('public')">
          <span class="material-icons-round">explore</span>
          <span class="nav-label">みんなの</span>
        </button>
      </nav>
    </div>

    <!-- 1.5 セット選択画面 -->
    <div id="screen-set-select" class="screen">
      <header class="header header-sub">
        <button class="header-back" onclick="App.showScreen('main')">
          <span class="material-icons-round">arrow_back</span>
        </button>
        <h1 class="header-title">セット選択</h1>
        <div class="header-spacer-sm"></div>
      </header>

      <main class="main-content with-header">
        <p class="section-description">セットを選択</p>

        <div class="set-list" id="set-list">
          <!-- セット一覧がここに入る -->
        </div>

        <div class="create-set-prompt">
          <p>好きなレシピでセットを作る？</p>
          <button class="btn-secondary" onclick="App.showScreen('set-create')">
            <span class="material-icons-round">add</span>
            新しいセットを作る
          </button>
        </div>
      </main>
    </div>

    <!-- 2. レシピSet作成画面 -->
    <div id="screen-set-create" class="screen">
      <header class="header header-sub">
        <button class="header-back" onclick="App.showScreen('set-select')">
          <span class="material-icons-round">arrow_back</span>
        </button>
        <h1 class="header-title">セットを作る</h1>
        <div class="header-spacer-sm"></div>
      </header>

      <main class="main-content with-header">
        <div class="set-create-form">
          <div class="form-group">
            <label class="form-label">セットの名前</label>
            <input type="text" id="set-name-input" class="form-input" placeholder="例: 定番おうちごはん">
          </div>

          <div class="form-group">
            <label class="form-label">レシピを選択（1〜7品）</label>
            <div class="selected-recipes" id="selected-recipes">
              <p class="empty-hint">まだ選んでないよ</p>
            </div>
            <button class="btn-add-recipe" onclick="App.showRecipeSelector()">
              <span class="material-icons-round">add</span>
              レシピを追加
            </button>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn-primary" id="btn-save-set" onclick="App.saveNewSet()" disabled>
            このセットを保存
          </button>
        </div>
      </main>
    </div>

    <!-- 3. レシピ登録画面 -->
    <div id="screen-recipe-add" class="screen">
      <header class="header header-sub">
        <button class="header-back" onclick="App.goBackFromRecipeAdd()">
          <span class="material-icons-round">arrow_back</span>
        </button>
        <h1 class="header-title">レシピを追加</h1>
        <div class="header-spacer-sm"></div>
      </header>

      <main class="main-content with-header">
        <!-- 反映エリア -->
        <div class="import-area">
          <label class="form-label">URLまたはテキストから取り込み</label>
          <textarea id="import-input" class="import-textarea" placeholder="レシピのURLやテキストを貼り付け"></textarea>
          <button class="btn-secondary btn-import" onclick="App.applyFromInput()">
            <span class="material-icons-round">auto_fix_high</span>
            反映する
          </button>
        </div>

        <div class="import-divider"></div>

        <div class="recipe-add-form">
          <div class="form-group">
            <label class="form-label">料理名</label>
            <input type="text" id="recipe-name-input" class="form-input" placeholder="例: 豚の生姜焼き">
          </div>

          <div class="form-group">
            <label class="form-label">何人前？</label>
            <div class="servings-selector">
              <button class="serving-btn" data-servings="1">1人前</button>
              <button class="serving-btn active" data-servings="2">2人前</button>
              <button class="serving-btn" data-servings="4">4人前</button>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">材料</label>
            <div class="ingredients-list" id="ingredients-list">
              <!-- 材料入力欄 -->
            </div>
            <button class="btn-add-ingredient" onclick="App.addIngredientRow()">
              <span class="material-icons-round">add</span>
              材料を追加
            </button>
          </div>

          <div class="form-group">
            <label class="form-label">URL（あれば）</label>
            <input type="url" id="recipe-url-input" class="form-input" placeholder="https://...">
          </div>

          <div class="form-group">
            <label class="form-label">タグ</label>
            <div class="tags-selector" id="tags-selector">
              <button class="tag-btn" data-tag="和食">和食</button>
              <button class="tag-btn" data-tag="洋食">洋食</button>
              <button class="tag-btn" data-tag="中華">中華</button>
              <button class="tag-btn" data-tag="時短">時短</button>
              <button class="tag-btn" data-tag="作り置き">作り置き</button>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn-primary" onclick="App.saveRecipe()">
            追加する
          </button>
        </div>
      </main>
    </div>

    <!-- 4. レシピ一覧画面（わたしの） -->
    <div id="screen-recipes" class="screen">
      <header class="header header-main">
        <div class="header-logo">
          <span class="logo-icon">🍳</span>
          <span class="logo-text">kondate loop</span>
        </div>
        <div class="header-actions">
          <button class="header-action has-badge" onclick="App.showFridge()">
            <span class="material-icons-round">kitchen</span>
            <span class="action-badge" id="badge-fridge-recipes"></span>
          </button>
          <button class="header-action has-badge" onclick="App.showScreen('shopping')">
            <span class="material-icons-round">shopping_cart</span>
            <span class="action-badge" id="badge-shopping-recipes"></span>
          </button>
        </div>
      </header>

      <main class="main-content with-nav">
        <h2 class="screen-title">わたしのMenu</h2>

        <!-- レシピ/セット タブ -->
        <div class="tab-switcher">
          <button class="tab-btn active" data-tab="my-recipes" onclick="App.switchMyTab('recipes')">レシピ</button>
          <button class="tab-btn" data-tab="my-sets" onclick="App.switchMyTab('sets')">セット</button>
        </div>

        <!-- 追加ボタン -->
        <button class="btn-add-item" id="btn-add-my" onclick="App.showAddForMyTab()">
          <span class="material-icons-round">add</span>
          <span id="btn-add-my-label">レシピを追加</span>
        </button>

        <div class="search-box">
          <span class="material-icons-round">search</span>
          <input type="text" id="recipe-search" class="search-input" placeholder="レシピを探す" oninput="App.filterMyItems()">
        </div>

        <!-- タグフィルター（レシピタブ用） -->
        <div class="tags-filter" id="my-tags-filter">
          <!-- タグボタンがここに動的に入る -->
        </div>

        <!-- レシピタブ -->
        <div id="my-recipes-tab" class="tab-content">
          <div class="recipe-list" id="recipe-list">
            <!-- レシピ一覧 -->
          </div>
          <div id="recipes-empty" class="empty-state hidden">
            <div class="empty-illustration">📝</div>
            <p class="empty-text">レシピがありません</p>
            <p class="empty-subtext">レシピを追加してみよう</p>
          </div>
        </div>

        <!-- セットタブ -->
        <div id="my-sets-tab" class="tab-content hidden">
          <div class="set-list" id="my-set-list">
            <!-- セット一覧 -->
          </div>
          <div id="my-sets-empty" class="empty-state hidden">
            <div class="empty-illustration">📦</div>
            <p class="empty-text">セットがありません</p>
            <p class="empty-subtext">レシピをまとめてセットを作ろう</p>
          </div>
        </div>
      </main>

      <nav class="bottom-nav">
        <button class="nav-item" onclick="App.showScreen('main')">
          <span class="material-icons-round">style</span>
          <span class="nav-label">献立</span>
        </button>
        <button class="nav-item active" onclick="App.showScreen('recipes')">
          <span class="material-icons-round">menu_book</span>
          <span class="nav-label">わたしの</span>
        </button>
        <button class="nav-item" onclick="App.showScreen('public')">
          <span class="material-icons-round">explore</span>
          <span class="nav-label">みんなの</span>
        </button>
      </nav>
    </div>

    <!-- 5. 買い物リスト画面 -->
    <div id="screen-shopping" class="screen">
      <header class="header header-sub">
        <button class="header-back" onclick="App.showScreen('main')">
          <span class="material-icons-round">arrow_back</span>
        </button>
        <h1 class="header-title">買うもの</h1>
        <div class="header-spacer-sm"></div>
      </header>

      <main class="main-content with-header">
        <div id="shopping-list" class="shopping-list">
          <!-- 買い物リスト -->
        </div>

        <div id="shopping-actions" class="shopping-actions hidden">
          <button id="btn-purchase-checked" class="btn-secondary" onclick="App.purchaseChecked()">
            <span class="material-icons-round">check</span>
            チェック済みを購入
          </button>
          <button class="btn-primary" onclick="App.purchaseAll()">
            <span class="material-icons-round">done_all</span>
            全部買った
          </button>
        </div>

        <div id="shopping-empty" class="empty-state">
          <div class="empty-illustration">🛒</div>
          <p class="empty-text">買うものはないよ</p>
          <p class="empty-subtext">セットを選ぶと出てくるよ</p>
        </div>
      </main>
    </div>

    <!-- 6. Public画面（みんなの） -->
    <div id="screen-public" class="screen">
      <header class="header header-main">
        <div class="header-logo">
          <span class="logo-icon">🍳</span>
          <span class="logo-text">kondate loop</span>
        </div>
        <div class="header-actions">
          <button class="header-action has-badge" onclick="App.showFridge()">
            <span class="material-icons-round">kitchen</span>
            <span class="action-badge" id="badge-fridge-public"></span>
          </button>
          <button class="header-action has-badge" onclick="App.showScreen('shopping')">
            <span class="material-icons-round">shopping_cart</span>
            <span class="action-badge" id="badge-shopping-public"></span>
          </button>
        </div>
      </header>

      <main class="main-content with-nav">
        <h2 class="screen-title">みんなのMenu</h2>

        <!-- レシピ/セット タブ -->
        <div class="tab-switcher">
          <button class="tab-btn active" data-tab="public-recipes" onclick="App.switchPublicTab('recipes')">レシピ</button>
          <button class="tab-btn" data-tab="public-sets" onclick="App.switchPublicTab('sets')">セット</button>
        </div>

        <div class="search-box">
          <span class="material-icons-round">search</span>
          <input type="text" id="public-search" class="search-input" placeholder="探す" oninput="App.filterPublicItems()">
        </div>

        <div class="tags-filter" id="public-tags-filter">
          <button class="tag-filter-btn active" data-tag="all">すべて</button>
          <button class="tag-filter-btn" data-tag="和食">和食</button>
          <button class="tag-filter-btn" data-tag="洋食">洋食</button>
          <button class="tag-filter-btn" data-tag="中華">中華</button>
          <button class="tag-filter-btn" data-tag="時短">時短</button>
        </div>

        <!-- レシピタブ -->
        <div id="public-recipes-tab" class="tab-content">
          <div class="public-recipe-list" id="public-recipe-list">
            <!-- 公開レシピ一覧 -->
          </div>
        </div>

        <!-- セットタブ -->
        <div id="public-sets-tab" class="tab-content hidden">
          <div class="public-set-list" id="public-set-list">
            <!-- 公開セット一覧（料理家のセット等） -->
          </div>
        </div>
      </main>

      <nav class="bottom-nav">
        <button class="nav-item" onclick="App.showScreen('main')">
          <span class="material-icons-round">style</span>
          <span class="nav-label">献立</span>
        </button>
        <button class="nav-item" onclick="App.showScreen('recipes')">
          <span class="material-icons-round">menu_book</span>
          <span class="nav-label">わたしの</span>
        </button>
        <button class="nav-item active" onclick="App.showScreen('public')">
          <span class="material-icons-round">explore</span>
          <span class="nav-label">みんなの</span>
        </button>
      </nav>
    </div>

    <!-- レシピ選択モーダル -->
    <div id="modal-recipe-selector" class="modal hidden">
      <div class="modal-backdrop" onclick="App.closeModal()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">レシピ選択</h2>
          <button class="modal-close" onclick="App.closeModal()">
            <span class="material-icons-round">close</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- タブ切替 -->
          <div class="tab-switcher" id="selector-tab-switcher">
            <button class="tab-btn active" data-tab="my" onclick="App.switchSelectorTab('my')">わたしの</button>
            <button class="tab-btn" data-tab="public" onclick="App.switchSelectorTab('public')">みんなの</button>
          </div>
          <div class="search-box">
            <span class="material-icons-round">search</span>
            <input type="text" id="modal-recipe-search" class="search-input" placeholder="レシピを探す" oninput="App.filterSelectorRecipes()">
          </div>
          <div class="modal-recipe-list" id="modal-recipe-list">
            <!-- 選択可能なレシピ -->
          </div>
          <button class="btn-text" onclick="App.showScreen('recipe-add'); App.closeModal();">
            <span class="material-icons-round">add</span>
            新しいレシピを追加
          </button>
        </div>
      </div>
    </div>

    <!-- レシピ詳細モーダル -->
    <div id="modal-recipe-detail" class="modal hidden">
      <div class="modal-backdrop" onclick="App.closeModal()"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2 class="modal-title" id="detail-recipe-name">レシピ名</h2>
          <button class="modal-close" onclick="App.closeModal()">
            <span class="material-icons-round">close</span>
          </button>
        </div>
        <div class="modal-body" id="detail-recipe-body">
          <!-- レシピ詳細 -->
        </div>
      </div>
    </div>

    <!-- 冷蔵庫モーダル -->
    <div id="modal-fridge" class="modal hidden">
      <div class="modal-backdrop" onclick="App.closeModal()"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2 class="modal-title">🧊 冷蔵庫</h2>
          <button class="modal-close" onclick="App.closeModal()">
            <span class="material-icons-round">close</span>
          </button>
        </div>
        <div class="modal-body" id="fridge-body">
          <!-- 冷蔵庫の中身 -->
        </div>
      </div>
    </div>

    <!-- セット詳細モーダル -->
    <div id="modal-set-detail" class="modal hidden">
      <div class="modal-backdrop" onclick="App.closeModal()"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2 class="modal-title" id="detail-set-name">セット名</h2>
          <button class="modal-close" onclick="App.closeModal()">
            <span class="material-icons-round">close</span>
          </button>
        </div>
        <div class="modal-body" id="detail-set-body">
          <!-- セット詳細 -->
        </div>
      </div>
    </div>

    <!-- トースト -->
    <div id="toast" class="toast hidden">
      <span class="toast-message"></span>
    </div>

    <!-- ガイドモーダル（オンボーディング用） -->
    <div id="modal-guide" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-content modal-guide-content">
        <div class="guide-illustration" id="guide-illustration"></div>
        <h2 class="guide-title" id="guide-title"></h2>
        <p class="guide-description" id="guide-description"></p>
        <div class="guide-actions" id="guide-actions"></div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
